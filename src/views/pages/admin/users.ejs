<link rel="stylesheet" href="/css/admin.css">

<div class="admin-container">
  <!-- Admin Header -->
  <header class="admin-header">
    <h1>üë• User Management</h1>
    <nav class="admin-nav">
      <a href="/admin">Dashboard</a>
      <a href="/admin/users" class="active">Users</a>
      <a href="/admin/threads">Threads</a>
      <a href="/">‚Üê Back to Forum</a>
    </nav>
  </header>

  <!-- Filters -->
  <div class="admin-filters">
    <a href="/admin/users" class="filter-btn <%= !currentRole ? 'active' : '' %>">
      All Users (<%= totalUsers %>)
    </a>
    <a href="/admin/users?role=user" class="filter-btn <%= currentRole === 'user' ? 'active' : '' %>">
      Users
    </a>
    <a href="/admin/users?role=moderator" class="filter-btn <%= currentRole === 'moderator' ? 'active' : '' %>">
      Moderators
    </a>
    <a href="/admin/users?role=admin" class="filter-btn <%= currentRole === 'admin' ? 'active' : '' %>">
      Admins
    </a>
  </div>

  <!-- Users Table -->
  <section class="admin-panel">
    <div class="panel-content">
      <% if (users && users.length > 0) { %>
        <table class="admin-table full-width">
          <thead>
            <tr>
              <th>ID</th>
              <th>Username</th>
              <th>Email</th>
              <th>Role</th>
              <th>Status</th>
              <th>Joined</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% users.forEach(user => { %>
              <tr class="<%= !user.isActive ? 'inactive-row' : '' %>">
                <td>#<%= user.id %></td>
                <td>
                  <a href="/profile/<%= user.username %>"><%= user.displayName || user.username %></a>
                </td>
                <td><%= user.email %></td>
                <td>
                  <form action="/admin/users/<%= user.id %>/role" method="POST" style="display: inline;">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    <select name="role" onchange="this.form.submit()" class="role-select">
                      <option value="user" <%= user.role === 'user' ? 'selected' : '' %>>User</option>
                      <option value="moderator" <%= user.role === 'moderator' ? 'selected' : '' %>>Moderator</option>
                      <option value="admin" <%= user.role === 'admin' ? 'selected' : '' %>>Admin</option>
                    </select>
                  </form>
                </td>
                <td>
                  <% if (user.isActive) { %>
                    <span class="status-badge active">Active</span>
                  <% } else { %>
                    <span class="status-badge inactive">Inactive</span>
                  <% } %>
                </td>
                <td><%= new Date(user.createdAt).toLocaleDateString() %></td>
                <td class="action-buttons">
                  <form action="/admin/users/<%= user.id %>/toggle-active" method="POST" style="display: inline;">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    <button type="submit" class="btn-icon" title="<%= user.isActive ? 'Deactivate' : 'Activate' %>">
                      <%= user.isActive ? 'üö´' : '‚úÖ' %>
                    </button>
                  </form>
                  <form action="/admin/users/<%= user.id %>/delete" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this user? This action cannot be undone.');">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    <button type="submit" class="btn-icon danger" title="Delete User">
                      üóëÔ∏è
                    </button>
                  </form>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>

        <!-- Pagination -->
        <% if (totalPages > 1) { %>
          <div class="admin-pagination">
            <% if (currentPage > 1) { %>
              <a href="?page=<%= currentPage - 1 %><%= currentRole ? '&role=' + currentRole : '' %>" class="pagination-btn">‚Üê Previous</a>
            <% } else { %>
              <span class="pagination-btn disabled">‚Üê Previous</span>
            <% } %>
            
            <span class="pagination-info">Page <%= currentPage %> of <%= totalPages %></span>
            
            <% if (currentPage < totalPages) { %>
              <a href="?page=<%= currentPage + 1 %><%= currentRole ? '&role=' + currentRole : '' %>" class="pagination-btn">Next ‚Üí</a>
            <% } else { %>
              <span class="pagination-btn disabled">Next ‚Üí</span>
            <% } %>
          </div>
        <% } %>
      <% } else { %>
        <p class="empty-state">No users found</p>
      <% } %>
    </div>
  </section>
</div>
